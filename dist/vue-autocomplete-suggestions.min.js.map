{"version":3,"file":"vue-autocomplete-suggestions.min.js","sources":["../src/DefaultSuggestionComponent.vue","../src/MinAutocomplete.vue"],"sourcesContent":["<template>\n  <span>{{ suggestion }} {{ active }}</span>\n</template>\n\n<script lang=\"ts\">\nimport Vue from 'vue'\nexport default Vue.extend({\n  props: {\n    suggestion: {\n      type: [Object, Number, String],\n      required: true,\n    },\n    active: {\n      type: Boolean,\n      required: true,\n    },\n  },\n})\n</script>\n","<template>\n  <section class=\"vue-autocomplete\" v-click-outside=\"hideSuggestions\">\n    <div ref=\"inputWrapper\" v-bind=\"inputAttributes\" v-on=\"inputListeners\">\n      <slot>\n        <input type=\"text\">\n      </slot>\n    </div>\n\n    <ul v-show=\"showSuggestions\" ref=\"suggestions\">\n      <slot name=\"misc-item-above\" :suggestions=\"suggestions\" />\n      <li v-for=\"(suggestion, index) in suggestions\" :key=\"getSuggestionText(suggestion)\" @click=\"selectSuggestion(suggestion)\" @mouseover=\"selectionIndex = index\" @mouseleave=\"selectionIndex = -1\">\n        <slot name=\"suggestionComponent\" v-bind=\"{suggestion, active: selectionIndex===index}\">\n          <default-suggestion-component v-bind=\"{suggestion, active: selectionIndex===index}\" />\n        </slot>\n      </li>\n      <slot name=\"misc-item-below\" :suggestions=\"suggestions\" />\n    </ul>\n  </section>\n</template>\n\n<script lang=\"ts\">\nimport Vue, { VNode } from 'vue'\nimport DefaultSuggestionComponent from './DefaultSuggestionComponent.vue'\n\ninterface Data {\n  selectionIndex: number\n  showSuggestions: boolean\n  suggestions: any[]\n  suggestionCache: object\n  inputElement: HTMLInputElement | null\n}\n\ntype Suggestion = string | object | number\n\nexport default Vue.extend({\n  name: 'VueAutocomplete',\n  components: {\n    DefaultSuggestionComponent,\n  },\n  directives: {\n    /** detect a click outside of the input and the suggestions\n     to hide the suggestions */\n    clickOutside: {\n      isFn: true,\n      bind(element: any, binding: any, vnode: VNode) {\n        element.event = (event: Event) => {\n          const { inputWrapper, suggestions } = vnode.context!.$refs\n\n          // check if the click was outside the components\n          if (\n            // @ts-ignore\n            !inputWrapper.contains(event.target) &&\n            // @ts-ignore\n            !suggestions.contains(event.target)\n          ) {\n            console.log('outside')\n\n            // if it was, call method provided in attribute value\n            // @ts-ignore\n            vnode.context[binding.expression](event)\n          }\n        }\n        document.body.addEventListener('click', element.event)\n      },\n      unbind(element: any) {\n        document.body.removeEventListener('click', element.event)\n      },\n    },\n  },\n  inheritAttrs: false,\n  props: {\n    cacheResults: {\n      type: Boolean,\n      default: true,\n    },\n    getSuggestionText: {\n      type: Function,\n      default(suggestion: any) {\n        return JSON.stringify(suggestion)\n      },\n    },\n    suggestionSource: {\n      type: [Array, Function],\n      required: true,\n    },\n    value: {\n      type: String,\n      required: true,\n    },\n  },\n  data(): Data {\n    return {\n      showSuggestions: false,\n      selectionIndex: -1,\n      suggestions: [],\n      // if suggestions source is an async function,\n      // save the result for each input inside this cache\n      suggestionCache: {},\n      inputElement: null,\n    }\n  },\n  computed: {\n    inputAttributes(): object {\n      return {\n        ...this.$attrs,\n        // @ts-ignore\n        value: this.value,\n      }\n    },\n    inputComponent(): Vue | undefined {\n      if (this.$slots.default && !!this.$slots.default[0].componentInstance) {\n        return this.$slots.default[0].componentInstance\n      }\n    },\n    inputListeners(): object {\n      return {\n        ...this.$listeners,\n        input: (event: Event) => {\n          const newValue = (event.target as HTMLInputElement).value\n          this.handleInput(newValue)\n        },\n        click: (event: Event) => {\n          this.handleClick()\n          this.$emit('click', event)\n        },\n        keydown: (event: KeyboardEvent) => {\n          const key = event.keyCode\n          const selectionUpKeys = [33, 38]\n          const selectionDownKeys = [34, 40]\n          const selectKeys = [9, 13, 36]\n          const hideSuggestionsKeys = [27, 35]\n\n          if (selectionUpKeys.includes(key)) {\n            this.handleKeyUp()\n          } else if (selectionDownKeys.includes(key)) {\n            this.handleKeyDown()\n          } else if (selectKeys.includes(key)) {\n            this.handleKeyEnter()\n          } else if (hideSuggestionsKeys.includes(key)) {\n            this.handleKeyEscape()\n          }\n\n          this.$emit('keydown', event)\n        },\n      }\n    },\n  },\n  watch: {\n    value(newValue) {\n      if (newValue === '') {\n        this.showSuggestions = false\n      }\n      this.updateInputValue(newValue)\n    },\n    // TODO: evaluate if this is necessary or can be done with less code\n    async suggestionSource(newSource) {\n      this.suggestions = await this.getSuggestions()\n    },\n  },\n  mounted() {\n    const inputWrapper = this.$refs.inputWrapper as HTMLDivElement\n    this.inputElement = inputWrapper.querySelector('input') as HTMLInputElement\n    // @ts-ignore\n    this.updateInputValue(this.value)\n    this.inputElement.addEventListener('focus', () => {\n      this.$emit('focus')\n    })\n  },\n  methods: {\n    updateInputValue(newValue: string) {\n      this.inputElement!.value = newValue\n      this.$emit('input', newValue)\n    },\n    async getSuggestions(): Promise<Suggestion[]> {\n      // get the current value, because it will be updated after this function is called\n      const currentValue = this.inputElement!.value\n      // @ts-ignore\n      if (typeof this.suggestionSource === 'function') {\n        // @ts-ignore\n        if (this.cacheResults) {\n          // @ts-ignore\n          if (!this.suggestionCache[currentValue]) {\n            // @ts-ignore\n            const newSuggestions = await this.suggestionSource()\n            // @ts-ignore\n            this.suggestionCache[currentValue] = newSuggestions\n          }\n          // @ts-ignore\n          return this.suggestionCache[currentValue]\n        }\n        // @ts-ignore\n        return this.suggestionSource()\n      }\n      // suggestion source is an array\n      // @ts-ignore\n      return this.suggestionSource\n    },\n    async handleClick() {\n      // @ts-ignore\n      if (this.value !== '') {\n        this.suggestions = await this.getSuggestions()\n        this.showSuggestions = true\n      }\n    },\n    handleKeyDown() {\n      // if its at the bottom, move to top\n      // if its not at the bottom move down by 1\n      // @ts-ignore\n      this.showSuggestions = true\n      this.selectionIndex = (this.selectionIndex + 1) % this.suggestions.length\n      this.scrollToCurrentSuggestion()\n    },\n    handleKeyEnter() {\n      const index = this.selectionIndex\n      // @ts-ignore\n      if (0 <= index && index < this.suggestions.length) {\n        // @ts-ignore\n        const currentSuggestion = this.suggestions[index]\n        // TODO: remove side effect\n        this.selectSuggestion(currentSuggestion)\n      }\n    },\n    handleKeyEscape() {\n      this.hideSuggestions()\n      this.inputElement!.blur()\n    },\n    handleKeyUp() {\n      // if its at the top, move to bottom\n      // if its not at the top move up by 1\n      this.selectionIndex =\n        // @ts-ignore\n        (this.selectionIndex - 1 + this.suggestions.length) %\n        // @ts-ignore\n        this.suggestions.length\n      this.scrollToCurrentSuggestion()\n    },\n    async handleInput(newValue: string) {\n      this.updateInputValue(newValue)\n      this.suggestions = await this.getSuggestions()\n      this.showSuggestions = true\n      this.selectionIndex = -1\n    },\n    hideSuggestions() {\n      if (this.showSuggestions) {\n        this.showSuggestions = false\n        this.selectionIndex = -1\n      }\n    },\n    selectSuggestion(suggestion: any) {\n      this.hideSuggestions()\n      this.$emit('select', suggestion)\n      // @ts-ignore\n      this.updateInputValue(this.getSuggestionText(suggestion))\n      this.inputElement!.blur()\n    },\n\n    scrollToCurrentSuggestion() {\n      // TODO:\n      // const suggestionItems = this.$refs.suggestionItems as any\n      // const selectedSuggestionItem = suggestionItems[this.selectionIndex]\n      // if (selectedSuggestionItem && selectedSuggestionItem.scrollIntoView) {\n      //   selectedSuggestionItem.scrollIntoView(false)\n      // }\n    },\n  },\n})\n</script>\n\n<style>\nhtml,\nbody {\n  height: 100%;\n}\n.vue-autocomplete {\n  position: relative;\n}\n\n.vue-autocomplete img {\n  position: absolute;\n  height: 0.85rem;\n  width: 0.85rem;\n  right: 0.5rem;\n  top: 50%;\n  transform: translateY(-50%);\n  cursor: pointer;\n  padding: 0.2rem;\n}\n\n.vue-autocomplete input {\n  width: 100%;\n  box-sizing: border-box;\n}\n.vue-autocomplete ul {\n  position: absolute;\n  padding-left: 0;\n  margin-top: 0;\n  margin-bottom: 0;\n  width: 100%;\n  overflow-y: auto;\n  max-height: 300px;\n  z-index: 1;\n}\n\n.vue-autocomplete li {\n  list-style: none;\n  cursor: pointer;\n  user-select: none;\n  background: #ffffff;\n}\n</style>\n"],"names":["extend","Object","Number","String","Boolean","__assign","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","next","e","rejected","step","result","done","then","apply","__generator","body","f","y","g","_","verb","Symbol","iterator","this","v","op","TypeError","label","ops","pop","trys","push","Vue","DefaultSuggestionComponent","element","binding","vnode","event","_a","context","$refs","inputWrapper","suggestions","contains","target","log","expression","addEventListener","removeEventListener","Function","suggestion","JSON","stringify","Array","$attrs","$slots","componentInstance","_this","$listeners","newValue","handleInput","handleClick","$emit","key","keyCode","includes","handleKeyUp","handleKeyDown","handleKeyEnter","handleKeyEscape","showSuggestions","updateInputValue","newSource","_b","getSuggestions","sent","inputElement","querySelector","currentValue","newSuggestions","suggestionSource","cacheResults","suggestionCache","selectionIndex","scrollToCurrentSuggestion","index","currentSuggestion","selectSuggestion","hideSuggestions","blur","getSuggestionText"],"mappings":"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"}